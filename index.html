<!DOCTYPE html>
<html>
<head>
    <title>Scientific Paper Managment Information System</title>

    <!-- Bootstrap for CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- For mobiles -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style type="text/css">

    body {
        background: #f8f8f8;
    }

    label {
        font-weight: normal;
    }

    #main-container {
        width: 60%;
        margin: auto;
    }

    .grid-row {
        display: table-row;
    }

    .grid-cell {
        display: table-cell;
        padding: 10px;
    }

    .date-input {
        width: 100px;
    }

    .heading {
        font-weight: bold;
        font-size: 1.3em;
    }

    #search-results {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        height: 100%;
    }

    #search-area {
        vertical-align: bottom;
    }

    #search-results li a {
        font-size: 1.2em;
    }

    .authors, .published-date {
        font-size: 0.9em;
    }

    .published-date {
        float: right;
    }

    .abstract-excerpt {
        color: gray;
    }

    </style>

</head>
<body>


<div id="main-container">

    <div class="grid-row">

        <!-- Title/logo -->
        <div class="grid-cell">
            <h1>Scientific Papers</h1>
        </div>

        <!-- Search box and search button -->
        <form class="grid-cell form-inline" id="search-area"
              onsubmit="search(this.query.value); return false">

            <input type="text" placeholder="Enter keywords..." class="form-control"
                   name="query" />
            <button class="btn btn-default">Search</button>
        </form>
    </div>

    <div class="grid-row">

        <!-- Sorting and filtering options -->
        <div class="grid-cell">

            <p class="heading">Sort by</p>

            <p>
                <select class="form-control">
                    <option>Relevance</option>
                    <option>Date ascending</option>
                    <option>Date descending</option>
                    <option>Reference count</option>
                </select>
            </p>

            <p class="heading">Filters</p>

            <p class="filter">
                <label>
                    <input type="checkbox" onchange="toggleFilter(this)">
                    Date between
                </label>
                <br />
                <span class="filter-controls">
                    <input type="text" class="date-input form-control" /> and
                    <input type="text" class="date-input form-control" />
                </span>
            </p>

            <p class="filter">
                <label>
                    <input type="checkbox" onchange="toggleFilter(this)">
                    Author:
                </label>
                <span class="filter-controls">
                    <input type="text" class="form-control" />
                </span>
            </p>
        </div>

        <div class="grid-cell">
            <!-- Search results -->
            <div id="search-results">
                <span id="intro-message">Please enter a search query</span>
                <p>
                    <b>Related keywords:</b>
                    <span id="related-keywords"></span>
                </p>
                <p>
                   Showing <b id="no-of-results"></b> results for <b id="search-query"></b>
                </p>
                <ol id="results-list"></ol>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">

/*
 * Search ScienceDirect with the search query provided and use the filters
 * selected on the page
 */
function search(query) {
    $("#search-results").children().show();
    $("#intro-message").remove();

    $("#search-area input").val(query);

    // TODO: Send an AJAX request to the ScienceDirect API here. When it
    // completes send the response to our server by calling rankResults()

    rankResults({
        "query": query,
        "papers": [
            {"title": "Test paper 1",
             "link": "http://www.google.co.uk",
             "authors": ["Bob Jones", "Dave Smith"],
             "published_date": "01/02/2003",
             "abstract": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus scelerisque sit amet ex ultrices porttitor. Sed pellentesque justo in mauris dapibus consectetur. Aliquam elementum id lorem eu vulputate. Nam sollicitudin metus nec suscipit tristique. Donec consectetur condimentum suscipit. Donec et ultrices sapien"}
        ],

        "related_keywords": ["maths", "computer science", "physics"]
    });  // temporary
}

/*
 * Send the search results from ScienceDirect to our server to be ranked, and
 * call showSearchResults() when it is complete
 */
function rankResults(results) {
    // TODO: Send an AJAX request to our server and call showSearchResults()
    // when it completes

    showSearchResults(results);
}

/*
 * Show the actual search results on the page
 */
function showSearchResults(results) {
    $("#no-of-results").text(results.papers.length);
    $("#search-query").text(results.query);
    $("#results-list").text("");
    $("#related-keywords").text("");

    // Show the related keywords
    for (let i=0; i<results.related_keywords.length; i++) {
        var $link = $("<a>", {"href": "#", "text": results.related_keywords[i]})
        $link.on("click",
            function() {
                search(results.related_keywords[i]);
            }
        );
        $("#related-keywords").append($link);

        if (i + 1 < results.related_keywords.length) {
            $("#related-keywords").append(", ");
        }
    }

    // Show the papers
    for (var i=0; i<results.papers.length; i++) {
        var $link = $("<a>", {
            "href": results.papers[i].link,
            "text": results.papers[i].title
        });

        var $authors = $("<span>", {
            "text": results.papers[i].authors.join(", "),
            "class": "authors"
        });

        var $date = $("<span>", {
            "text": "Published " + results.papers[i].published_date,
            "class": "published-date"
        });

        // Trim the abstract if it is too long
        var abstract = results.papers[i].abstract
        if (abstract.length > 100) {
            abstract = abstract.substr(0, 100) + "...";
        }

        var $p = $("<p>", {
            "text": abstract,
            "class": "abstract-excerpt"
        });

        var $li = $("<li>");
        $li.append($link, "<br />", $authors, $date, $p);
        $("#results-list").append($li);
    }
}

/*
 * Enable/disable the controls for a filter when the checkbox is
 * checked/unchecked
 */
function toggleFilter(checkbox) {

    var $el = $(checkbox);
    while (!($el.hasClass("filter"))) {
        $el = $el.parent();
    }

    var $inputs = $el.find(".filter-controls input");

    $inputs.each(function (index, input) {
        input.disabled = !checkbox.checked;
    });
}

// Enable or disable all the filter controls so that they match the state of
// the checkboxes
var checkboxes = document.querySelectorAll(".filter input[type=checkbox]");
for (var i=0; i<checkboxes.length; i++) {
    checkboxes[i].onchange();
}

$(document).ready(function() {
    // Hide the search results area
    $("#search-results").children().hide();
    $("#intro-message").show();
});

</script>

</body>
</html>